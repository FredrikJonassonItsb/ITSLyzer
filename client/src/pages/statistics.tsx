import { StatisticsPanel } from '@/components/statistics-panel';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Calendar, Download, Filter, RefreshCw, TrendingUp } from 'lucide-react';\nimport { useState } from 'react';\nimport type { Statistics } from '@shared/schema';\n\nexport function StatisticsPage() {\n  const [timeRange, setTimeRange] = useState('all');\n  const [isRefreshing, setIsRefreshing] = useState(false);\n\n  // Mock statistics data\n  const mockStatistics: Statistics = {\n    totalRequirements: 1247,\n    mustRequirements: 892,\n    shouldRequirements: 355,\n    organizations: 12,\n    groups: 387,\n    newRequirements: 45,\n    categories: [\n      { name: 'Säkerhet', count: 234 },\n      { name: 'Integration', count: 187 },\n      { name: 'Prestanda', count: 156 },\n      { name: 'Användbarhet', count: 134 },\n      { name: 'Backup', count: 123 },\n      { name: 'GDPR', count: 98 },\n      { name: 'Rapportering', count: 87 },\n      { name: 'API', count: 76 },\n      { name: 'Mobilanpassning', count: 65 },\n      { name: 'Övervakning', count: 54 },\n      { name: 'Användbarhet', count: 43 },\n      { name: 'Skalbarhet', count: 38 }\n    ],\n    organizationStats: [\n      { name: 'Karolinska Universitetssjukhuset', count: 187 },\n      { name: 'Stockholms Läns Landsting', count: 156 },\n      { name: 'Danderyds sjukhus', count: 134 },\n      { name: 'Södersjukhuset', count: 123 },\n      { name: 'St Görans sjukhus', count: 98 },\n      { name: 'Ersta sjukhus', count: 87 },\n      { name: 'S:t Eriks ögonsjukhus', count: 76 },\n      { name: 'Capio Sankt Görans sjukhus', count: 65 },\n      { name: 'Nacka sjukhus', count: 54 },\n      { name: 'Norrtälje sjukhus', count: 43 },\n      { name: 'Södertälje sjukhus', count: 32 },\n      { name: 'Nyköpings lasarett', count: 28 }\n    ],\n    statusStats: [\n      { status: 'OK', count: 856 },\n      { status: 'Under utveckling', count: 234 },\n      { status: 'Senare', count: 157 }\n    ]\n  };\n\n  const handleRefresh = async () => {\n    console.log('Refreshing statistics...');\n    setIsRefreshing(true);\n    \n    // Simulate API call\n    setTimeout(() => {\n      setIsRefreshing(false);\n    }, 2000);\n  };\n\n  const handleExportReport = () => {\n    console.log('Exporting statistics report for time range:', timeRange);\n    // TODO: Implement export functionality\n  };\n\n  const handleApplyFilter = () => {\n    console.log('Apply advanced filters');\n    // TODO: Implement advanced filtering\n  };\n\n  const getTimeRangeDescription = (range: string) => {\n    switch (range) {\n      case 'week': return 'Senaste veckan';\n      case 'month': return 'Senaste månaden';\n      case 'quarter': return 'Senaste kvartalet';\n      case 'year': return 'Senaste året';\n      default: return 'All historisk data';\n    }\n  };\n\n  // Calculate trends (mock data)\n  const trends = {\n    requirementGrowth: '+12%',\n    organizationGrowth: '+2',\n    completionRate: '+5%',\n    averageProcessingTime: '-15%'\n  };\n\n  return (\n    <div className=\"p-6 max-w-7xl mx-auto space-y-8\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Statistik och rapporter</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Översikt över dina krav, organisationer och trends.\n          </p>\n        </div>\n        \n        <div className=\"flex items-center gap-3\">\n          <Select value={timeRange} onValueChange={setTimeRange}>\n            <SelectTrigger className=\"w-48\" data-testid=\"select-time-range\">\n              <Calendar className=\"h-4 w-4 mr-2\" />\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"week\">Senaste veckan</SelectItem>\n              <SelectItem value=\"month\">Senaste månaden</SelectItem>\n              <SelectItem value=\"quarter\">Senaste kvartalet</SelectItem>\n              <SelectItem value=\"year\">Senaste året</SelectItem>\n              <SelectItem value=\"all\">All tid</SelectItem>\n            </SelectContent>\n          </Select>\n          \n          <Button\n            variant=\"outline\"\n            onClick={handleApplyFilter}\n            className=\"gap-2\"\n            data-testid=\"button-advanced-filters\"\n          >\n            <Filter className=\"h-4 w-4\" />\n            Avancerade filter\n          </Button>\n          \n          <Button\n            variant=\"outline\"\n            onClick={handleRefresh}\n            disabled={isRefreshing}\n            className=\"gap-2\"\n            data-testid=\"button-refresh\"\n          >\n            <RefreshCw className={`h-4 w-4 ${isRefreshing ? 'animate-spin' : ''}`} />\n            {isRefreshing ? 'Uppdaterar...' : 'Uppdatera'}\n          </Button>\n          \n          <Button\n            onClick={handleExportReport}\n            className=\"gap-2\"\n            data-testid=\"button-export-report\"\n          >\n            <Download className=\"h-4 w-4\" />\n            Exportera rapport\n          </Button>\n        </div>\n      </div>\n\n      {/* Time Range Summary */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Översikt - {getTimeRangeDescription(timeRange)}\n          </CardTitle>\n          <CardDescription>\n            Statistik baserad på vald tidsperiod med trender jämfört med föregående period.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n            <div className=\"text-center p-4 bg-muted rounded-lg\">\n              <div className=\"text-2xl font-bold\">{mockStatistics.totalRequirements.toLocaleString('sv-SE')}</div>\n              <div className=\"text-sm text-muted-foreground mb-2\">Totalt krav</div>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {trends.requirementGrowth} sedan förra perioden\n              </Badge>\n            </div>\n            \n            <div className=\"text-center p-4 bg-muted rounded-lg\">\n              <div className=\"text-2xl font-bold\">{mockStatistics.organizations}</div>\n              <div className=\"text-sm text-muted-foreground mb-2\">Organisationer</div>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {trends.organizationGrowth} nya\n              </Badge>\n            </div>\n            \n            <div className=\"text-center p-4 bg-muted rounded-lg\">\n              <div className=\"text-2xl font-bold\">92%</div>\n              <div className=\"text-sm text-muted-foreground mb-2\">Uppfyllelsegrad</div>\n              <Badge variant=\"outline\" className=\"text-xs text-green-600\">\n                {trends.completionRate} förbättring\n              </Badge>\n            </div>\n            \n            <div className=\"text-center p-4 bg-muted rounded-lg\">\n              <div className=\"text-2xl font-bold\">2.3 dagar</div>\n              <div className=\"text-sm text-muted-foreground mb-2\">Snitt behandlingstid</div>\n              <Badge variant=\"outline\" className=\"text-xs text-green-600\">\n                {trends.averageProcessingTime} snabbare\n              </Badge>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Main Statistics Panel */}\n      <StatisticsPanel statistics={mockStatistics} />\n\n      {/* Additional Insights */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Top Performing Organizations */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Mest aktiva organisationer</CardTitle>\n            <CardDescription>\n              Organisationer med flest krav den senaste perioden.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {mockStatistics.organizationStats.slice(0, 5).map((org, index) => (\n                <div key={org.name} className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary text-primary-foreground text-sm font-medium\">\n                      {index + 1}\n                    </div>\n                    <span className=\"font-medium truncate max-w-[200px]\" title={org.name}>\n                      {org.name}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm font-medium\">{org.count} krav</span>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {Math.round((org.count / mockStatistics.totalRequirements) * 100)}%\n                    </Badge>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Recent Activity Summary */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Aktivitetssammanfattning</CardTitle>\n            <CardDescription>\n              Översikt över systemaktivitet den senaste tiden.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center p-3 bg-muted rounded-lg\">\n                <span className=\"text-sm font-medium\">Importer den senaste veckan</span>\n                <Badge variant=\"secondary\">7 filer</Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center p-3 bg-muted rounded-lg\">\n                <span className=\"text-sm font-medium\">AI-grupperingar utförda</span>\n                <Badge variant=\"secondary\">23 sessioner</Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center p-3 bg-muted rounded-lg\">\n                <span className=\"text-sm font-medium\">Krav med uppdaterad status</span>\n                <Badge variant=\"secondary\">156 krav</Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center p-3 bg-muted rounded-lg\">\n                <span className=\"text-sm font-medium\">Nya kommentarer</span>\n                <Badge variant=\"secondary\">89 kommentarer</Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center p-3 bg-muted rounded-lg\">\n                <span className=\"text-sm font-medium\">Exporterade rapporter</span>\n                <Badge variant=\"secondary\">12 rapporter</Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Export Information */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Rapportexport</CardTitle>\n          <CardDescription>\n            Information om tillgängliga exportformat och schemalagda rapporter.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <h4 className=\"font-medium mb-3\">Tillgängliga format:</h4>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant=\"outline\">Excel (.xlsx)</Badge>\n                  <span className=\"text-muted-foreground\">Detaljerad kravdata med alla kolumner</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant=\"outline\">PDF</Badge>\n                  <span className=\"text-muted-foreground\">Färdig rapport med diagram och sammanfattning</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant=\"outline\">CSV</Badge>\n                  <span className=\"text-muted-foreground\">Enkel dataexport för vidare analys</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant=\"outline\">JSON</Badge>\n                  <span className=\"text-muted-foreground\">Strukturerad data för systemintegration</span>\n                </div>\n              </div>\n            </div>\n            \n            <div>\n              <h4 className=\"font-medium mb-3\">Schemalagda rapporter:</h4>\n              <div className=\"space-y-2 text-sm text-muted-foreground\">\n                <p>• Veckorapport - varje måndag 08:00</p>\n                <p>• Månadssammanfattning - första dagen varje månad</p>\n                <p>• Kvartalsöversikt - slutet av kvartalet</p>\n                <p>• Årsrapport - 31 december</p>\n              </div>\n              <Button size=\"sm\" variant=\"outline\" className=\"mt-3\">\n                Konfigurera scheman\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default StatisticsPage;