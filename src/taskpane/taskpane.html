<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://appsforoffice.microsoft.com;
    connect-src 'self' https://demo.hubs.se;
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
  ">
  <title>Nextcloud Talk f√∂r Outlook</title>
  <link rel="stylesheet" href="taskpane.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h1 class="app-title">
          <img src="../../assets/icons/icon-32.png" alt="Nextcloud" class="app-icon">
          Nextcloud Talk
        </h1>
        <div id="userInfo" class="user-info" style="display: none;">
          <span id="userName"></span>
          <button id="logoutBtn" class="btn-link">Logga ut</button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="app-content">
      <!-- Login View -->
      <div id="loginView" class="view">
        <div class="login-container">
          <div class="login-icon">
            <img src="../../assets/icons/icon-64.png" alt="Nextcloud">
          </div>
          <h2>V√§lkommen till Nextcloud Talk</h2>
          <p>Logga in f√∂r att skapa videom√∂ten direkt fr√•n Outlook</p>
          <button id="loginBtn" class="btn btn-primary">
            <span class="btn-icon">üîê</span>
            Logga in med Nextcloud
          </button>
        </div>
      </div>

      <!-- Main View -->
      <div id="mainView" class="view" style="display: none;">
        <!-- Meeting Info -->
        <section class="section">
          <h2 class="section-title">M√∂tesinformation</h2>
          <div id="meetingInfo" class="meeting-info">
            <div class="info-row">
              <label>Titel:</label>
              <span id="meetingTitle">-</span>
            </div>
            <div class="info-row">
              <label>Start:</label>
              <span id="meetingStart">-</span>
            </div>
            <div class="info-row">
              <label>Slut:</label>
              <span id="meetingEnd">-</span>
            </div>
            <div class="info-row">
              <label>Deltagare:</label>
              <span id="meetingParticipants">-</span>
            </div>
          </div>
        </section>

        <!-- Create Meeting Button -->
        <section class="section">
          <button id="createMeetingBtn" class="btn btn-primary btn-large">
            <span class="btn-icon">üìπ</span>
            Skapa Nextcloud Talk-m√∂te
          </button>
          <p class="help-text">
            Skapar ett Talk-rum och synkroniserar med Nextcloud Kalender
          </p>
        </section>

        <!-- Participant Settings (shown after clicking create) -->
        <section id="participantSettingsSection" class="section" style="display: none;">
          <h2 class="section-title">Deltagarinst√§llningar</h2>
          <p class="help-text">
            Konfigurera s√§kerhets- och notifieringsinst√§llningar per deltagare
          </p>
          
          <div id="participantsList" class="participants-list">
            <!-- Dynamiskt genererat inneh√•ll -->
          </div>

          <div class="action-buttons">
            <button id="cancelSettingsBtn" class="btn btn-secondary">Avbryt</button>
            <button id="confirmCreateBtn" class="btn btn-primary">Skapa m√∂te</button>
          </div>
        </section>

        <!-- Meeting Created View -->
        <section id="meetingCreatedSection" class="section" style="display: none;">
          <div class="success-message">
            <div class="success-icon">‚úì</div>
            <h2>Talk-m√∂te skapat!</h2>
            <p>M√∂tet har lagts till i din kalenderinbjudan och synkroniserats med Nextcloud.</p>
          </div>
          
          <div class="meeting-link">
            <label>M√∂tesl√§nk:</label>
            <div class="link-container">
              <input type="text" id="talkLink" readonly>
              <button id="copyLinkBtn" class="btn-icon-only" title="Kopiera l√§nk">
                üìã
              </button>
            </div>
          </div>

          <button id="doneBtn" class="btn btn-primary">Klar</button>
        </section>
      </div>

      <!-- Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p id="loadingMessage">Laddar...</p>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="error-message" style="display: none;">
        <div class="error-content">
          <span class="error-icon">‚ö†Ô∏è</span>
          <span id="errorText"></span>
        </div>
        <button id="closeErrorBtn" class="btn-icon-only">√ó</button>
      </div>
    </main>
  </div>

  <!-- Office.js -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  
  <!-- Dependencies -->
  <script src="../utils/config.js"></script>
  <script src="../utils/storage.js"></script>
  <script src="../utils/i18n.js"></script>
  <script src="../auth/auth.js"></script>
  <script src="../api/nextcloud-client.js"></script>
  
  <!-- Main Script -->
  <script src="taskpane.js"></script>
</body>
</html>

